
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Umsetzung in Python &#8212; Computational Business Analytics</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Installation &amp; Setup" href="../chapter_02/Installation.html" />
    <link rel="prev" title="Fragestellung" href="Introduction_Fallstudie.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/datascience2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Business Analytics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Dieses Buch durchsuchen ..." aria-label="Dieses Buch durchsuchen ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Vorwort.html">
   Vorwort
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  01 Einleitung
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Business_Analytics.html">
   Warum Business Analytics?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Warum_Coding.html">
   Warum Programmieren?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_Warum_Python.html">
   Warum Python?
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Fallstudie.html">
   Ausblick: was sie erwartet
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Introduction_Fallstudie.html">
     Fragestellung
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Umsetzung in Python
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  02 Technisches Setup
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter_02/Installation.html">
   Installation &amp; Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter_02/Intro_Jupyter.html">
   Einführung Jupyter Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter_02/Intro_Skript.html">
   Nutzung dieses Skripts
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  03 Python | Grundlagen
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter_03/Intro_Python.html">
   Einführung in Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter_03/Intro_Python_Excercises.html">
     Übungen 1
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter_03/Functions_Iterations_Python.html">
   Iterationen und Funktionen
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter_03/Functions_Iterations_Python_Excercises.html">
     Übungen 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter_03/If_Statements_Python.html">
   Entscheidungsstrukturen
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter_03/If_Statements_Python_Excercises.html">
     Übungen 3
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  04 Python | Module
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter_04/Intro_Modules.html">
   Einführung
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter_04/Intro_Numpy.html">
   NumPy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter_04/Intro_Numpy_exercise.html">
     Übungsblatt: Numpy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter_04/Intro_Pandas.html">
   Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter_04/Intro_Pandas_exercise.html">
     Übungen: Pandas
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <div>
    
</div>

</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Navigation umschalten" aria-controls="site-navigation"
                title="Navigation umschalten" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Laden Sie diese Seite herunter"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/chapter_01/Umsetzung_Fallstudie.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Quelldatei herunterladen" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="In PDF drucken"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Vollbildmodus"
        title="Vollbildmodus"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/fredzett/Skript-Business-Analytics/blob/master/chapters/chapter_01/Umsetzung_Fallstudie.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Starten Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Inhalt
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vorarbeiten">
   Vorarbeiten
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-1-fragestellung">
   Schritt 1: Fragestellung
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-2-beschaffung-der-daten">
   Schritt 2: Beschaffung der Daten
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-3-aufbereitung-der-daten">
   Schritt 3: Aufbereitung der Daten
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ansatz-1-zuruck-in-die-vergangenheit">
     Ansatz 1: Zurück in die Vergangenheit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-4-analyse-fur-ansatz-1">
   Schritt 4: Analyse für Ansatz 1
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fazit-ansatz-1">
     Fazit: Ansatz 1
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-4-historischer-zufall">
   Schritt 4: Historischer Zufall
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gesamtfazit">
   Gesamtfazit
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Umsetzung in Python</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Inhalt </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vorarbeiten">
   Vorarbeiten
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-1-fragestellung">
   Schritt 1: Fragestellung
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-2-beschaffung-der-daten">
   Schritt 2: Beschaffung der Daten
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-3-aufbereitung-der-daten">
   Schritt 3: Aufbereitung der Daten
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ansatz-1-zuruck-in-die-vergangenheit">
     Ansatz 1: Zurück in die Vergangenheit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-4-analyse-fur-ansatz-1">
   Schritt 4: Analyse für Ansatz 1
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fazit-ansatz-1">
     Fazit: Ansatz 1
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schritt-4-historischer-zufall">
   Schritt 4: Historischer Zufall
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gesamtfazit">
   Gesamtfazit
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="umsetzung-in-python">
<h1>Umsetzung in Python<a class="headerlink" href="#umsetzung-in-python" title="Permalink to this headline">¶</a></h1>
<div class="section" id="vorarbeiten">
<h2>Vorarbeiten<a class="headerlink" href="#vorarbeiten" title="Permalink to this headline">¶</a></h2>
<p>Bevor wir loslegen, müssen zunächst Module importiert werden, die wir im Rahmen der Analyse benötigen. Im Kapitel <a class="reference internal" href="../chapter_04/Intro_Modules.html"><span class="doc std std-doc">04 Module</span></a> werden wir die Hintergründe hierzu erläutern. Python (wie die meistern Programmiersprachen) wird von Hause aus weitestgehend ohne Funktionalität für Datenanalyse oder Visualisierung bereitstellt. Die dafür benötigten Funktionen können dann jedoch via sogenannter Module importiert werden. Die einzelnen Module werden im weiteren Verlaufe des Skriptes bzw. der Lehrveranstaltung eingeführt und erläutert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modul `BusinessAnalytics` muss bei erster Nutzung zunächst installiert werden:</span>
<span class="c1">#  - google colab: via `!pip install BusinessAnalytics`</span>
<span class="c1">#  - jupyter notebook: via `%pip install BusinessAnalytics``</span>
<span class="kn">from</span> <span class="nn">BusinessAnalytics</span> <span class="kn">import</span> <span class="n">get_stock_data</span><span class="p">,</span> <span class="n">plot</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># Modul für DataFrames</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="schritt-1-fragestellung">
<h2>Schritt 1: Fragestellung<a class="headerlink" href="#schritt-1-fragestellung" title="Permalink to this headline">¶</a></h2>
<p>Dieser Schritt unterscheidet sich nicht von den konzeptionellen Überlegungen im <a class="reference internal" href="Introduction_Fallstudie.html"><span class="doc std std-doc">vorherigen Kapitel</span></a>. Die konkrete Fragestellung lautet also:</p>
<p><strong>Wie wahrscheinlich ist es, dass wir bei einer Investition in den DAX einen Verlust nach X Jahren erleiden?</strong></p>
<p>Machen wir uns nun an die konkrete Beantwortung der Frage via Python</p>
</div>
<div class="section" id="schritt-2-beschaffung-der-daten">
<h2>Schritt 2: Beschaffung der Daten<a class="headerlink" href="#schritt-2-beschaffung-der-daten" title="Permalink to this headline">¶</a></h2>
<p>Unsere Analyse fußt auf historischen Dax-Kursen. Diese müssen wir nun in Python einlesen. Hierfür gibt es prinzipiell zwei Ansätze (die dann auf verschiedene Art und Weisen umgesetzt werden können):</p>
<ol class="simple">
<li><p>manuelles Herunterladen und Abspeichern der Daten als (z.B.) <code class="docutils literal notranslate"><span class="pre">csv</span></code>-Datei und dann einlesen der Datei</p></li>
<li><p>direktes Einlesen der Daten via Python-Code ohne Zwischenspeichern einer Datei</p></li>
</ol>
<p>Prinzipiell haben beide Varianten Vor- und Nachteile. In <a class="reference internal" href="Introduction_Fallstudie.html"><span class="doc std std-doc">vorherigen Kapitel</span></a> wurde <a class="reference internal" href="Introduction_Fallstudie.html#download-yahoo"><span class="std std-ref">hier</span></a> aufgezeigt, wie wir die konkreten DAX-Daten als Datei abspeichern. In unserem Fall verzichten wir darauf und wählen Variante 2, d.h. wir laden die Daten direkt in Python. Wir müssen dafür den Yahoo-Ticker für den DAX (<code class="docutils literal notranslate"><span class="pre">^GDAXI</span></code>) sowie Start- und Enddatum der benötigten Daten angeben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dax</span> <span class="o">=</span> <span class="n">get_stock_data</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="s2">&quot;^GDAXI&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;30-12-1987&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;31-07-2022&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Was macht der obige Programmcode?</p>
<p>Mit der Funktion <code class="docutils literal notranslate"><span class="pre">get_stock_data</span></code> laden wir die Yahoo-Daten herunter. Das Ergebnis ist ein sog. <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> (stellen Sie sich eine Art Excel-Tabelle vor), in dem alle Yahoo-Daten gespeichert sind. Diesen Dataframe “speichern”<a class="footnote-reference brackets" href="#id4" id="id1">1</a> wir unter dem Namen <code class="docutils literal notranslate"><span class="pre">data_dax</span></code>.  Dieser Name ist beliebig; jeder andere Name wäre hier auch möglich gewesen. Es ist jedoch gute Programmier-Praxis beschreibende Namen zu wählen. Wir werden in diesem Skript englische Namen wählen, da dies ebenfalls übliche Praxis ist.</p>
<p>Schauen wir uns die Daten an. Dies machen wir, in dem wir in eine Code-Zelle den Namen der Variable schreiben:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dax</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
      <th>ticker</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1987-12-30</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>0.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1987-12-31</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1988-01-01</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1988-01-04</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>0.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1988-01-05</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>0.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8901</th>
      <td>2022-07-25</td>
      <td>13183.240234</td>
      <td>13337.059570</td>
      <td>13151.860352</td>
      <td>13210.320313</td>
      <td>13210.320313</td>
      <td>56561100.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>8902</th>
      <td>2022-07-26</td>
      <td>13181.919922</td>
      <td>13197.950195</td>
      <td>13042.410156</td>
      <td>13096.929688</td>
      <td>13096.929688</td>
      <td>58207700.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>8903</th>
      <td>2022-07-27</td>
      <td>13158.639648</td>
      <td>13204.580078</td>
      <td>13089.959961</td>
      <td>13166.379883</td>
      <td>13166.379883</td>
      <td>79894900.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>8904</th>
      <td>2022-07-28</td>
      <td>13214.410156</td>
      <td>13289.389648</td>
      <td>13091.259766</td>
      <td>13282.110352</td>
      <td>13282.110352</td>
      <td>74308800.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>8905</th>
      <td>2022-07-29</td>
      <td>13353.280273</td>
      <td>13515.030273</td>
      <td>13340.589844</td>
      <td>13484.049805</td>
      <td>13484.049805</td>
      <td>82631600.0</td>
      <td>^GDAXI</td>
    </tr>
  </tbody>
</table>
<p>8906 rows × 8 columns</p>
</div></div></div>
</div>
<p>Bei großen Datenmengen bietet es sich an, nur einen Teil der Informationen anzuzeigen. Wir können z.B. nur die ersten 5 Zeilen ausgeben lassen mit Hilfe der “Funktion” <code class="docutils literal notranslate"><span class="pre">head</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dax</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
      <th>ticker</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1987-12-30</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>1005.190002</td>
      <td>0.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1987-12-31</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1988-01-01</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1988-01-04</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>956.489990</td>
      <td>0.0</td>
      <td>^GDAXI</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1988-01-05</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>996.099976</td>
      <td>0.0</td>
      <td>^GDAXI</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Nachdem wir die Daten nun in Python eingelesen haben, beginnen wir mit dem nächsten Schritt, der Aufbereitung der Daten.</p>
</div>
<div class="section" id="schritt-3-aufbereitung-der-daten">
<h2>Schritt 3: Aufbereitung der Daten<a class="headerlink" href="#schritt-3-aufbereitung-der-daten" title="Permalink to this headline">¶</a></h2>
<p>Yahoo hat insgesamt 8.906 Tage mit Dax-Daten bereitgestellt. Jede Zeile beinhaltet Informationen eines Tages. An den Spaltenüberschriften erkennen wir, welche Daten vorliegen.</p>
<ul class="simple">
<li><p>Open: Eröffnungskurs des Tages</p></li>
<li><p>High: Höchstkurs des Tages</p></li>
<li><p>Low: Tiefstkurs des Tages</p></li>
<li><p>Close: Schlusskurs des Tages</p></li>
<li><p>Adj. Close: Schlusskurs des Tages adjustiert um z.B. Dividendeneffekte</p></li>
<li><p>Volume: Handelsvolumen an dem Tag</p></li>
<li><p>ticker: Yahoo-Ticker des Datenpunktes</p></li>
</ul>
<p>Für unsere Zwecke benötigen nur einen Dax-Kurs pro Tag. Wir werden deshalb den <code class="docutils literal notranslate"><span class="pre">Adj.</span> <span class="pre">Close</span></code>-Kurs nehmen und alle anderen Daten mit Ausnahme des Datums wieder herausnehmen. Zusätzlich werden wir die Spalten noch umbenennen in “Datum” und “Preis” und fehlende Datenpunkte (gekennzeichnet als <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (“not a number”)) löschen<a class="footnote-reference brackets" href="#id5" id="id2">2</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dax</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_dax</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Adj Close&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Filtern der benötigten Spalten</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span> <span class="s2">&quot;Datum&quot;</span><span class="p">,</span> <span class="s2">&quot;Adj Close&quot;</span><span class="p">:</span> <span class="s2">&quot;Preis&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Umbenennen der Spaltennamen</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1"># Fehlende Datenpunkte entfernen</span>
            <span class="p">)</span>
<span class="c1"># Ergebnis anzeigen lassen</span>
<span class="n">data_dax</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Datum</th>
      <th>Preis</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1987-12-30</td>
      <td>1005.190002</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1988-01-04</td>
      <td>956.489990</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1988-01-05</td>
      <td>996.099976</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1988-01-06</td>
      <td>1006.010010</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1988-01-07</td>
      <td>1014.469971</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8901</th>
      <td>2022-07-25</td>
      <td>13210.320313</td>
    </tr>
    <tr>
      <th>8902</th>
      <td>2022-07-26</td>
      <td>13096.929688</td>
    </tr>
    <tr>
      <th>8903</th>
      <td>2022-07-27</td>
      <td>13166.379883</td>
    </tr>
    <tr>
      <th>8904</th>
      <td>2022-07-28</td>
      <td>13282.110352</td>
    </tr>
    <tr>
      <th>8905</th>
      <td>2022-07-29</td>
      <td>13484.049805</td>
    </tr>
  </tbody>
</table>
<p>8738 rows × 2 columns</p>
</div></div></div>
</div>
<p>Bevor wir die Daten für unsere Zwecke weiter aufbereiten, schauen wir uns diese an, um sicherzustellen, dass die Kursentwicklung plausibel aussieht.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_dax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Datum&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Preis&quot;</span><span class="p">,</span> 
     <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tägliche Entwicklung DAX</span><span class="se">\n</span><span class="s2">(1988 - 2022)&quot;</span><span class="p">,</span>
     <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Umsetzung_Fallstudie_16_0.png" src="../../_images/Umsetzung_Fallstudie_16_0.png" />
</div>
</div>
<p>Mit der Funktion <code class="docutils literal notranslate"><span class="pre">plot</span></code> können wir die Daten visualisieren, d.h. Graphen bzw. Plots daraus generieren. Wir müssen dafür nur die Datenquelle (hier: <code class="docutils literal notranslate"><span class="pre">dax_data</span></code>) und die X- sowie die Y-Achse angeben (“Datum” und “Preis”).  Optional haben wir noch angegeben, dass die Linie rot sein soll und der Plot eine Überschrift, aber keine Legende haben soll.</p>
<p>Die Entwicklung - wir können diese mit Charts auf Finanzportalen vergleichen - sieht plausibel aus. Wir haben offensichtlich die richtigen Daten von Yahoo heruntergeladen.</p>
<p>Im nächsten Schritt müssen wir nun die Renditen berechnen, da wir diese für beide Ansätze - “Zurück in die Vergangenheit” und “historischer Zufall” - benötigen. Wir erstellen deshalb eine neue Spalte (“Rendite”), in der wir die tägliche Rendite (Hinweis: <span class="math notranslate nohighlight">\(r_t = \frac{P_t}{P_{t-1}} -1\)</span>) speichern. Dies können wir z.B. mit der Funktion <code class="docutils literal notranslate"><span class="pre">pct_change</span></code> berechnen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dax</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_dax</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Rendite</span><span class="o">=</span><span class="n">data_dax</span><span class="p">[</span><span class="s2">&quot;Preis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">())</span> <span class="c1"># Erstelle neue Spalte &quot;Rendite&quot;</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1"># Entferne NaN-Spalten, da für ersten Kurs kein Vorkurs existiert</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Datum&quot;</span><span class="p">,</span> <span class="s2">&quot;Preis&quot;</span><span class="p">])</span> <span class="c1"># Spalten Datum und Preis werden nicht mehr benötigt</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Periode</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_df</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">_df</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># Periode der Investition (1 bis letzte Zeile)</span>
            <span class="p">)</span>
<span class="c1"># Ergebnis anzeigen lassen (hier: erste 10 Zeilen)</span>
<span class="n">data_dax</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rendite</th>
      <th>Periode</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>-0.048449</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.041412</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.009949</td>
      <td>3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.008409</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.012046</td>
      <td>5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.038152</td>
      <td>6</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.000638</td>
      <td>7</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.021401</td>
      <td>8</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.008998</td>
      <td>9</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-0.022577</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Wir fassen, was wir bisher berechnet haben in eine Funktion <code class="docutils literal notranslate"><span class="pre">calculate_returns</span></code> zusammen. Dies macht den Code übersichtlicher; insbesondere, wenn wir später ggf. Änderungen vornehmen möchten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_returns</span><span class="p">(</span><span class="n">_df</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">_df</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Adj Close&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Filtern der benötigten Spalten</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span> <span class="s2">&quot;Datum&quot;</span><span class="p">,</span> <span class="s2">&quot;Adj Close&quot;</span><span class="p">:</span> <span class="s2">&quot;Preis&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Umbenennen der Spaltennamen</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1"># Fehlende Datenpunkte entfernen</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Rendite</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_data</span><span class="p">:</span> <span class="n">_data</span><span class="p">[</span><span class="s2">&quot;Preis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">())</span> <span class="c1"># Erstelle neue Spalte &quot;Rendite&quot;</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1"># Entferne NaN-Spalten, da für ersten Kurs kein Vorkurs existiert</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Datum&quot;</span><span class="p">,</span> <span class="s2">&quot;Preis&quot;</span><span class="p">])</span> <span class="c1"># Spalten Datum und Preis werden nicht mehr benötigt</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Periode</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_data</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># Periode der Investition (1 bis letzte Zeile)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<p>Wir können jetzt alles zusammenfassen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dax</span> <span class="o">=</span> <span class="n">get_stock_data</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="s2">&quot;^GDAXI&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;30-12-1987&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;31-07-2022&quot;</span><span class="p">)</span>
<span class="n">data_dax</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_dax</span>
           <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_returns</span><span class="p">)</span>
           <span class="p">)</span>
<span class="n">data_dax</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rendite</th>
      <th>Periode</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.048449</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.041412</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.009949</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.008409</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.012046</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="ansatz-1-zuruck-in-die-vergangenheit">
<h3>Ansatz 1: Zurück in die Vergangenheit<a class="headerlink" href="#ansatz-1-zuruck-in-die-vergangenheit" title="Permalink to this headline">¶</a></h3>
<p>Im ersten Ansatz haben wir uns überlegt, dass wir für jeden Tag, an dem wir hätten investieren können (implizite Annahme: zu adjustierten Schlusskursen) untersuchen, wie diese Investition sich über die Zeit entwickelt hätte. Dafür müssen wir uns die Renditen für jeden Tag genauer anschauen.</p>
<div class="tip admonition">
<p class="admonition-title">Beispiel für drei Anlagen</p>
<p><strong>Beispiel 1:</strong>
Hätten wir bspw. am Handelstag vor dem 4.1.1988 investiert, dann hätten wir nach dem ersten vollen Handelstag eine Rendite von <span class="math notranslate nohighlight">\((10-0.0484) - 1\)</span> gemacht. Nach zwei Tagen hätten wir eine Rendite von <span class="math notranslate nohighlight">\((1-0.0484)\times(1+0.0414) - 1 \ldots\)</span> usw.</p>
<p><strong>Beispiel 2:</strong>
Hätten wir bspw. am Handelstag vor dem 5.1.1988 investiert, dann hätten wir nach dem ersten vollen Handelstag eine Rendite von <span class="math notranslate nohighlight">\((1+0.0414) - 1\)</span> gemacht. Nach zwei Tagen hätten wir eine Rendite von <span class="math notranslate nohighlight">\((1+0.0414)\times(1+0.0099) - 1\ldots\)</span> usw.</p>
<p><strong>Beispiel 3:</strong>
Hätten wir bspw. am Handelstag vor dem 6.1.1988 investiert, dann hätten wir nach dem ersten vollen Handelstag eine Rendite von <span class="math notranslate nohighlight">\((1+0.0099) - 1\)</span> gemacht. Nach zwei Tagen hätten wir eine Rendite von <span class="math notranslate nohighlight">\((1+0.0099)\times(1+0.0084) - 1\ldots\)</span> usw.</p>
</div>
<p>Jede Anlage beginnt also immer genau einen Tag später. Der Anfangszeitpunkt ist somit immer .genau eine Zeile später. Dies können wir in Python sehr einfach abbilden.</p>
<p>Untenstehend ein Beispiel für unsere drei Beispielanlagen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beispiel</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_dax</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Anlage1</span><span class="o">=</span><span class="n">data_dax</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># Renditen für Startdatum 5.1.1988</span>
                    <span class="n">Anlage2</span><span class="o">=</span><span class="n">data_dax</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="c1"># Renditen für Startdatum 6.1.1988</span>
                    <span class="n">Anlage3</span><span class="o">=</span><span class="n">data_dax</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># Renditen für Startdatum 7.1.1988</span>
            <span class="p">)</span>
<span class="n">beispiel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rendite</th>
      <th>Periode</th>
      <th>Anlage1</th>
      <th>Anlage2</th>
      <th>Anlage3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.048449</td>
      <td>1</td>
      <td>-0.048449</td>
      <td>0.041412</td>
      <td>0.009949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.041412</td>
      <td>2</td>
      <td>0.041412</td>
      <td>0.009949</td>
      <td>0.008409</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.009949</td>
      <td>3</td>
      <td>0.009949</td>
      <td>0.008409</td>
      <td>0.012046</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.008409</td>
      <td>4</td>
      <td>0.008409</td>
      <td>0.012046</td>
      <td>-0.038152</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.012046</td>
      <td>5</td>
      <td>0.012046</td>
      <td>-0.038152</td>
      <td>-0.000638</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8732</th>
      <td>-0.003271</td>
      <td>8733</td>
      <td>-0.003271</td>
      <td>-0.008583</td>
      <td>0.005303</td>
    </tr>
    <tr>
      <th>8733</th>
      <td>-0.008583</td>
      <td>8734</td>
      <td>-0.008583</td>
      <td>0.005303</td>
      <td>0.008790</td>
    </tr>
    <tr>
      <th>8734</th>
      <td>0.005303</td>
      <td>8735</td>
      <td>0.005303</td>
      <td>0.008790</td>
      <td>0.015204</td>
    </tr>
    <tr>
      <th>8735</th>
      <td>0.008790</td>
      <td>8736</td>
      <td>0.008790</td>
      <td>0.015204</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8736</th>
      <td>0.015204</td>
      <td>8737</td>
      <td>0.015204</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>8737 rows × 5 columns</p>
</div></div></div>
</div>
<p>Schauen wir uns den Programmcode an, dann sehen wir, dass wir für jedes weitere Startdatum die Spalte “Rendite” immer um eine Zeile versetzen (engl. “shift”) müssen.</p>
<p>Jedoch benötigen wir nicht die Renditen, sondern die kumulierten Produkte (engl. cumulative product) der Renditen, d.h.:</p>
<div class="math notranslate nohighlight">
\[(1+r_t)\times(1+r_{t+1})\ldots\times(1+r_{t+N}) - 1 = \ldots\]</div>
<p>Dafür müssen wir den obigen Programmcode nur geringfügig verändern:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beispiel</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_dax</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Anlage1</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">data_dax</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># kum. Produkt der Renditen für Startdatum 5.1.1988</span>
                    <span class="n">Anlage2</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">data_dax</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># kum. Produkt der Renditen für Startdatum 6.1.1988</span>
                    <span class="n">Anlage3</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">data_dax</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># kum. Produkt der Renditen für Startdatum 7.1.1988</span>
            <span class="p">)</span>
<span class="n">beispiel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rendite</th>
      <th>Periode</th>
      <th>Anlage1</th>
      <th>Anlage2</th>
      <th>Anlage3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.048449</td>
      <td>1</td>
      <td>-0.048449</td>
      <td>0.041412</td>
      <td>0.009949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.041412</td>
      <td>2</td>
      <td>-0.009043</td>
      <td>0.051773</td>
      <td>0.018442</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.009949</td>
      <td>3</td>
      <td>0.000816</td>
      <td>0.060617</td>
      <td>0.030710</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.008409</td>
      <td>4</td>
      <td>0.009232</td>
      <td>0.073393</td>
      <td>-0.008614</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.012046</td>
      <td>5</td>
      <td>0.021389</td>
      <td>0.032442</td>
      <td>-0.009246</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8732</th>
      <td>-0.003271</td>
      <td>8733</td>
      <td>12.142113</td>
      <td>12.692699</td>
      <td>12.217930</td>
    </tr>
    <tr>
      <th>8733</th>
      <td>-0.008583</td>
      <td>8734</td>
      <td>12.029308</td>
      <td>12.765309</td>
      <td>12.334114</td>
    </tr>
    <tr>
      <th>8734</th>
      <td>0.005303</td>
      <td>8735</td>
      <td>12.098399</td>
      <td>12.886304</td>
      <td>12.536844</td>
    </tr>
    <tr>
      <th>8735</th>
      <td>0.008790</td>
      <td>8736</td>
      <td>12.213532</td>
      <td>13.097429</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8736</th>
      <td>0.015204</td>
      <td>8737</td>
      <td>12.414429</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>8737 rows × 5 columns</p>
</div></div></div>
</div>
<p>Nun ist es natürlich sehr mühsam, diesen Vorgang für alle möglichen Startzeitpunkte (d.h. 8734x) zu wiederholen. Glücklicherweise müssen wir dies auch nicht, sondern können diesen Vorgang automatisieren via Python<a class="footnote-reference brackets" href="#id6" id="id3">3</a>.</p>
<p>Bevor wir dies tun, sollten wir jedoch noch eine Mindestlaufzeit definieren, für die unsere Anlagen laufen müssen, um berücksichtigt zu werden. Ansonsten haben unsere letzten Anlagen nur wenige Datenpunkte; z.B. hätte eine Anlage mit den Startpunkt 28.7.2022 nur einen Datenpunkt.</p>
<p>Wir nehmen deshalb an, dass wir für mindestens 1000 Handelstage - d.h. ca. 5 Jahre - investieren möchten.</p>
<p>Hier folgt der Code für</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_cumreturns_hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">min_laufzeit</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Funktion, um kumulierte Renditen aller Anlagen zu berechnen</span>
<span class="sd">    </span>
<span class="sd">    Input: </span>
<span class="sd">    - data: Datensatz, mit Renditedaten</span>
<span class="sd">    - min_laufzeit: Angabe über Mindestlaufzeit einer Anlage</span>

<span class="sd">    Output: Dataframe mit Daten aus &quot;data&quot; und Renditedaten für jede Anlage</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">## Vorarbeiten</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># Anzahl Zeilen im Datensatz</span>
    <span class="n">data_new</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Erstelle Kopie des Datensatz, um bei Fehlern Daten nicht zu überschreiben</span>

    <span class="c1">## Berechne Renditen aller Anlagen, die Kriterium min_laufzeit erfüllen</span>
    <span class="n">anlagen</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;Anlage_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:(</span><span class="n">data_new</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">))</span>
                           <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">rows</span><span class="o">-</span><span class="n">min_laufzeit</span><span class="p">)}</span> <span class="c1"># Berechne Renditen alle Anlagen</span>
    <span class="n">anlagen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">anlagen</span><span class="p">)</span> <span class="c1"># Speicher Anlagen in Dataframe</span>
    
    <span class="c1">## Berechne kumulierte Rendite</span>
    <span class="n">anlagen</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">anlagen</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1">## Verbinde ursprüngliche Daten mit neuen Anlagen-Daten</span>
    <span class="n">data_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data_new</span><span class="p">,</span> <span class="n">anlagen</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
    
    <span class="c1">## Gib Daten aus</span>
    <span class="k">return</span> <span class="n">data_combined</span><span class="c1">#.reset_index(drop=True)</span>
</pre></div>
</div>
</div>
</div>
<p>Den obigen Programmcode nutzen wir nun, um einen neuen Dataframe zu erstellen, in dem das kumulierte Produkt der Renditen aller Anlagen berechnet wurde.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_t</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">data_anlagen</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_dax</span>
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_cumreturns_hist</span><span class="p">,</span> <span class="n">min_laufzeit</span><span class="o">=</span><span class="n">min_t</span><span class="p">)</span> <span class="c1"># Berechne Renditen aller Anlagen</span>
               <span class="p">)</span>
<span class="n">data_anlagen</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rendite</th>
      <th>Periode</th>
      <th>Anlage_1</th>
      <th>Anlage_2</th>
      <th>Anlage_3</th>
      <th>Anlage_4</th>
      <th>Anlage_5</th>
      <th>Anlage_6</th>
      <th>Anlage_7</th>
      <th>Anlage_8</th>
      <th>...</th>
      <th>Anlage_7728</th>
      <th>Anlage_7729</th>
      <th>Anlage_7730</th>
      <th>Anlage_7731</th>
      <th>Anlage_7732</th>
      <th>Anlage_7733</th>
      <th>Anlage_7734</th>
      <th>Anlage_7735</th>
      <th>Anlage_7736</th>
      <th>Anlage_7737</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.048449</td>
      <td>1</td>
      <td>-0.048449</td>
      <td>0.041412</td>
      <td>0.009949</td>
      <td>0.008409</td>
      <td>0.012046</td>
      <td>-0.038152</td>
      <td>-0.000638</td>
      <td>-0.021401</td>
      <td>...</td>
      <td>0.005534</td>
      <td>-0.001391</td>
      <td>0.003967</td>
      <td>-0.001158</td>
      <td>0.003370</td>
      <td>-0.019861</td>
      <td>-0.005281</td>
      <td>0.000011</td>
      <td>-0.015848</td>
      <td>0.006097</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.041412</td>
      <td>2</td>
      <td>-0.009043</td>
      <td>0.051773</td>
      <td>0.018442</td>
      <td>0.020556</td>
      <td>-0.026566</td>
      <td>-0.038765</td>
      <td>-0.022025</td>
      <td>-0.012595</td>
      <td>...</td>
      <td>0.004135</td>
      <td>0.002571</td>
      <td>0.002804</td>
      <td>0.002207</td>
      <td>-0.016558</td>
      <td>-0.025037</td>
      <td>-0.005270</td>
      <td>-0.015837</td>
      <td>-0.009847</td>
      <td>0.003909</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.009949</td>
      <td>3</td>
      <td>0.000816</td>
      <td>0.060617</td>
      <td>0.030710</td>
      <td>-0.018380</td>
      <td>-0.027187</td>
      <td>-0.059336</td>
      <td>-0.013225</td>
      <td>-0.034887</td>
      <td>...</td>
      <td>0.008119</td>
      <td>0.001409</td>
      <td>0.006183</td>
      <td>-0.017697</td>
      <td>-0.021752</td>
      <td>-0.025027</td>
      <td>-0.021034</td>
      <td>-0.009837</td>
      <td>-0.012001</td>
      <td>0.013836</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.008409</td>
      <td>4</td>
      <td>0.009232</td>
      <td>0.073393</td>
      <td>-0.008614</td>
      <td>-0.019006</td>
      <td>-0.048005</td>
      <td>-0.050872</td>
      <td>-0.035503</td>
      <td>0.016456</td>
      <td>...</td>
      <td>0.006951</td>
      <td>0.004784</td>
      <td>-0.013800</td>
      <td>-0.022885</td>
      <td>-0.021741</td>
      <td>-0.040478</td>
      <td>-0.015066</td>
      <td>-0.011991</td>
      <td>-0.002231</td>
      <td>0.018209</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.012046</td>
      <td>5</td>
      <td>0.021389</td>
      <td>0.032442</td>
      <td>-0.009246</td>
      <td>-0.040000</td>
      <td>-0.039439</td>
      <td>-0.072300</td>
      <td>0.015807</td>
      <td>-0.006799</td>
      <td>...</td>
      <td>0.010344</td>
      <td>-0.015172</td>
      <td>-0.019008</td>
      <td>-0.022874</td>
      <td>-0.037245</td>
      <td>-0.034627</td>
      <td>-0.017208</td>
      <td>-0.002220</td>
      <td>0.002073</td>
      <td>0.018309</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.038152</td>
      <td>6</td>
      <td>-0.017579</td>
      <td>0.031783</td>
      <td>-0.030449</td>
      <td>-0.031362</td>
      <td>-0.061125</td>
      <td>-0.022947</td>
      <td>-0.007433</td>
      <td>-0.026801</td>
      <td>...</td>
      <td>-0.009722</td>
      <td>-0.020373</td>
      <td>-0.018998</td>
      <td>-0.038360</td>
      <td>-0.031374</td>
      <td>-0.036727</td>
      <td>-0.007489</td>
      <td>0.002084</td>
      <td>0.002171</td>
      <td>0.016655</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.000638</td>
      <td>7</td>
      <td>-0.018206</td>
      <td>0.009702</td>
      <td>-0.021725</td>
      <td>-0.053230</td>
      <td>-0.011178</td>
      <td>-0.045301</td>
      <td>-0.027422</td>
      <td>-0.038150</td>
      <td>...</td>
      <td>-0.014952</td>
      <td>-0.020363</td>
      <td>-0.034545</td>
      <td>-0.032496</td>
      <td>-0.033482</td>
      <td>-0.027202</td>
      <td>-0.003208</td>
      <td>0.002181</td>
      <td>0.000543</td>
      <td>0.019034</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.021401</td>
      <td>8</td>
      <td>-0.039216</td>
      <td>0.018787</td>
      <td>-0.043811</td>
      <td>-0.002863</td>
      <td>-0.033801</td>
      <td>-0.064528</td>
      <td>-0.038764</td>
      <td>-0.020681</td>
      <td>...</td>
      <td>-0.014941</td>
      <td>-0.035888</td>
      <td>-0.028658</td>
      <td>-0.034601</td>
      <td>-0.023924</td>
      <td>-0.023005</td>
      <td>-0.003111</td>
      <td>0.000553</td>
      <td>0.002885</td>
      <td>0.030856</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.008998</td>
      <td>9</td>
      <td>-0.030571</td>
      <td>-0.004213</td>
      <td>0.007058</td>
      <td>-0.025676</td>
      <td>-0.053259</td>
      <td>-0.075437</td>
      <td>-0.021306</td>
      <td>-0.024582</td>
      <td>...</td>
      <td>-0.030552</td>
      <td>-0.030009</td>
      <td>-0.030771</td>
      <td>-0.025054</td>
      <td>-0.019713</td>
      <td>-0.022910</td>
      <td>-0.004730</td>
      <td>0.002895</td>
      <td>0.014519</td>
      <td>0.029961</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.022577</td>
      <td>10</td>
      <td>-0.052458</td>
      <td>0.048762</td>
      <td>-0.015982</td>
      <td>-0.045298</td>
      <td>-0.064300</td>
      <td>-0.058645</td>
      <td>-0.025205</td>
      <td>-0.018877</td>
      <td>...</td>
      <td>-0.024641</td>
      <td>-0.032119</td>
      <td>-0.021186</td>
      <td>-0.020849</td>
      <td>-0.019618</td>
      <td>-0.024497</td>
      <td>-0.002401</td>
      <td>0.014530</td>
      <td>0.013638</td>
      <td>0.032777</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 7739 columns</p>
</div></div></div>
</div>
<p>Als Ergebnis sehen wir einen Datensatz, der die kumulierten Produkte der Renditen von Anlage 1 bis Anlage 7737 beinhaltet.  Diesen können wir mithilfe des folgenden Programmcode auch graphisch Darstellen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_anlagen</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Funktion, um Anlagen zu Plotten</span>
<span class="sd">    </span>
<span class="sd">    Hinweis: Hilfefunktion, da `plot`-Funktion ansonsten zu lange rechnet</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;Anlage&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Periode&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Rendite der Anlage&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wertentwicklung aller Anlagen in DAX</span><span class="se">\n</span><span class="s2">(Anlagezeitraum mindestens </span><span class="si">{</span><span class="n">min_t</span><span class="si">}</span><span class="s2"> Tage)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.08</span><span class="p">)</span>
    <span class="c1">#ax.set_title(f&quot;Wertentwicklung aller Anlagen in DAX\n(Anlagezeitraum mindestens {min_t} Tage)&quot;, y=1.08)</span>

    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Verlustlinie&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;Verlustlinie&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Hinweis: die Berechnung kann ja nach Computer einige Minuten dauern</span>
<span class="n">plot_anlagen</span><span class="p">(</span><span class="n">data_anlagen</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Umsetzung_Fallstudie_35_0.png" src="../../_images/Umsetzung_Fallstudie_35_0.png" />
</div>
</div>
<p>Wir sehen bereits, dass ca. ab Periode 4.000 keine Anlage (unabhängig vom Startpunkt) noch einen Verlust - d.h. Rendite von unter 0% - gemacht hat. Bevor wir die Verlustwahrscheinlichkeit nun aber konkret, wie im vorherigen Kapitel erläutert, berechnen, wollen wir unseren Programmcode nochmals strukturieren und zusammenfassen. Unsere bisherige Aufbereitung der Daten umfasste im Wesentlichen auf drei Schritte:</p>
<ol class="simple">
<li><p>Herunterladen der Daten</p></li>
<li><p>Berechnung der Renditen</p></li>
<li><p>Berechnung der kumulierten Produkte der Renditen je Anlage</p></li>
</ol>
<p>Diese drei Schritte fassen wir nun in drei Funktionen zusammen. In Summe macht dies den Code besser lesbarer und schneller adaptierbar, falls weitere Analysen hinzukommen sollten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_t</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">get_stock_data</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="s2">&quot;^GDAXI&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;30-12-1987&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;31-07-2022&quot;</span><span class="p">)</span> <span class="c1"># Herunterladen der Daten</span>
             <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_returns</span><span class="p">)</span> <span class="c1"># Berechnung der Renditen</span>
             <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_cumreturns_hist</span><span class="p">,</span> <span class="n">min_t</span><span class="p">)</span> <span class="c1"># Berechnung der kumulierten Renditen je Anlagestartpunkt</span>
             <span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rendite</th>
      <th>Periode</th>
      <th>Anlage_1</th>
      <th>Anlage_2</th>
      <th>Anlage_3</th>
      <th>Anlage_4</th>
      <th>Anlage_5</th>
      <th>Anlage_6</th>
      <th>Anlage_7</th>
      <th>Anlage_8</th>
      <th>...</th>
      <th>Anlage_7728</th>
      <th>Anlage_7729</th>
      <th>Anlage_7730</th>
      <th>Anlage_7731</th>
      <th>Anlage_7732</th>
      <th>Anlage_7733</th>
      <th>Anlage_7734</th>
      <th>Anlage_7735</th>
      <th>Anlage_7736</th>
      <th>Anlage_7737</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.048449</td>
      <td>1</td>
      <td>-0.048449</td>
      <td>0.041412</td>
      <td>0.009949</td>
      <td>0.008409</td>
      <td>0.012046</td>
      <td>-0.038152</td>
      <td>-0.000638</td>
      <td>-0.021401</td>
      <td>...</td>
      <td>0.005534</td>
      <td>-0.001391</td>
      <td>0.003967</td>
      <td>-0.001158</td>
      <td>0.003370</td>
      <td>-0.019861</td>
      <td>-0.005281</td>
      <td>0.000011</td>
      <td>-0.015848</td>
      <td>0.006097</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.041412</td>
      <td>2</td>
      <td>-0.009043</td>
      <td>0.051773</td>
      <td>0.018442</td>
      <td>0.020556</td>
      <td>-0.026566</td>
      <td>-0.038765</td>
      <td>-0.022025</td>
      <td>-0.012595</td>
      <td>...</td>
      <td>0.004135</td>
      <td>0.002571</td>
      <td>0.002804</td>
      <td>0.002207</td>
      <td>-0.016558</td>
      <td>-0.025037</td>
      <td>-0.005270</td>
      <td>-0.015837</td>
      <td>-0.009847</td>
      <td>0.003909</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.009949</td>
      <td>3</td>
      <td>0.000816</td>
      <td>0.060617</td>
      <td>0.030710</td>
      <td>-0.018380</td>
      <td>-0.027187</td>
      <td>-0.059336</td>
      <td>-0.013225</td>
      <td>-0.034887</td>
      <td>...</td>
      <td>0.008119</td>
      <td>0.001409</td>
      <td>0.006183</td>
      <td>-0.017697</td>
      <td>-0.021752</td>
      <td>-0.025027</td>
      <td>-0.021034</td>
      <td>-0.009837</td>
      <td>-0.012001</td>
      <td>0.013836</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.008409</td>
      <td>4</td>
      <td>0.009232</td>
      <td>0.073393</td>
      <td>-0.008614</td>
      <td>-0.019006</td>
      <td>-0.048005</td>
      <td>-0.050872</td>
      <td>-0.035503</td>
      <td>0.016456</td>
      <td>...</td>
      <td>0.006951</td>
      <td>0.004784</td>
      <td>-0.013800</td>
      <td>-0.022885</td>
      <td>-0.021741</td>
      <td>-0.040478</td>
      <td>-0.015066</td>
      <td>-0.011991</td>
      <td>-0.002231</td>
      <td>0.018209</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.012046</td>
      <td>5</td>
      <td>0.021389</td>
      <td>0.032442</td>
      <td>-0.009246</td>
      <td>-0.040000</td>
      <td>-0.039439</td>
      <td>-0.072300</td>
      <td>0.015807</td>
      <td>-0.006799</td>
      <td>...</td>
      <td>0.010344</td>
      <td>-0.015172</td>
      <td>-0.019008</td>
      <td>-0.022874</td>
      <td>-0.037245</td>
      <td>-0.034627</td>
      <td>-0.017208</td>
      <td>-0.002220</td>
      <td>0.002073</td>
      <td>0.018309</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8732</th>
      <td>-0.003271</td>
      <td>8733</td>
      <td>12.142113</td>
      <td>12.692699</td>
      <td>12.217930</td>
      <td>12.202762</td>
      <td>12.291719</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8733</th>
      <td>-0.008583</td>
      <td>8734</td>
      <td>12.029308</td>
      <td>12.765309</td>
      <td>12.334114</td>
      <td>12.403495</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8734</th>
      <td>0.005303</td>
      <td>8735</td>
      <td>12.098399</td>
      <td>12.886304</td>
      <td>12.536844</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8735</th>
      <td>0.008790</td>
      <td>8736</td>
      <td>12.213532</td>
      <td>13.097429</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8736</th>
      <td>0.015204</td>
      <td>8737</td>
      <td>12.414429</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>8737 rows × 7739 columns</p>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="schritt-4-analyse-fur-ansatz-1">
<h2>Schritt 4: Analyse für Ansatz 1<a class="headerlink" href="#schritt-4-analyse-fur-ansatz-1" title="Permalink to this headline">¶</a></h2>
<p>Schlussendlich wollen wir bestimmen, wie wahrscheinlich ein Verlust nach X Perioden. Im vorherigen Kapitel haben wir uns Gedanken dazu gemacht, wie wir dies berechnen können. Hierzu müssen wir für jeden Handelstag die Anzahl der Anlagen addieren, die eine Rendite von unter 0% gemacht haben und durch die Anzahl aller Anlagen teilen.</p>
<p>Im Programmcode ist dies sehr einfach abzubilden:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_loss_probabilities</span><span class="p">(</span><span class="n">_data</span><span class="p">):</span>
    <span class="n">data_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">_data</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Verlustwahrscheinlichkeit</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_df</span><span class="p">:</span> <span class="p">(</span><span class="n">_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;Anlage&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">_df</span><span class="p">))</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">data_new</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_final</span> <span class="o">=</span> <span class="n">calculate_loss_probabilities</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">data_final</span><span class="p">[[</span><span class="s2">&quot;Periode&quot;</span><span class="p">,</span> <span class="s2">&quot;Verlustwahrscheinlichkeit&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Periode</th>
      <th>Verlustwahrscheinlichkeit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.413529</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0.400824</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0.395330</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0.390065</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0.389722</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8732</th>
      <td>8733</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8733</th>
      <td>8734</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8734</th>
      <td>8735</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8735</th>
      <td>8736</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8736</th>
      <td>8737</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>8737 rows × 2 columns</p>
</div></div></div>
</div>
<p>An der Tabelle sehen wir, dass die Verlustwahrscheinlichkeit nach einem Tag bei ca. 40% liegt. Jedoch sehen wir, dass die Verlustwahrscheinlichkeit in den letzten Perioden 0% beträgt. D.h. in unserem Datensatz gab es z.B. keine Anlage, die nach 8733 Perioden noch eine Rendite von unter 0% gemacht hatte. Noch klarer wird die Berechnung, wenn wir die Verlustwahrscheinlichkeit plotten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_verlustwahrscheinlichkeit</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
     <span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Periode&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Verlustwahrscheinlichkeit&quot;</span><span class="p">,</span>
          <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;historische Verlustwahrscheinlichkeit Anlage in DAX&quot;</span><span class="p">,</span>
          <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
     <span class="n">day0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Verlustwahrscheinlichkeit&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
     <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>
     <span class="k">if</span> <span class="n">day0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">day0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Verlustwahrscheinlichkeit&quot;</span><span class="p">])</span>
          <span class="n">loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Verlustwahrscheinlichkeit&quot;</span><span class="p">])</span>
     <span class="n">day01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Verlustwahrscheinlichkeit&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">))</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tag </span><span class="si">{</span><span class="n">day0</span><span class="si">}</span><span class="s2">: p = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">loss</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">day0</span><span class="p">,</span><span class="n">loss</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">day0</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span><span class="n">loss</span><span class="o">+</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span> <span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">))</span>
     <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tag </span><span class="si">{</span><span class="n">day01</span><span class="si">}</span><span class="s2">: p = 10%&quot;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">day01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">day01</span><span class="p">,</span><span class="mf">0.15</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span> <span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">))</span>
     
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_verlustwahrscheinlichkeit</span><span class="p">(</span><span class="n">data_final</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Umsetzung_Fallstudie_44_0.png" src="../../_images/Umsetzung_Fallstudie_44_0.png" />
</div>
</div>
<div class="section" id="fazit-ansatz-1">
<h3>Fazit: Ansatz 1<a class="headerlink" href="#fazit-ansatz-1" title="Permalink to this headline">¶</a></h3>
<p>Mit unserer empirischen Analyse konnten wir die Ausgangsfrage beantworten. Die Verlustwahrscheinlichkeit bei Investition in den DAX ist real. Allerdings beschränkt sich dies historische auf einen kurzen Anlagehorizont. So gab es auf Basis der historischen Daten keinen Zeitpunkt einer Anlage, bei der man nach mehr als 3.444 Tagen (ca. 17 Jahre) noch einen Verlust gemacht hätte. Selbst bei der Hälfte der Anlagedauer, d.h. nach ca. 9 Jahren, betrug die Verlustwahrscheinlichkeit nur noch 10%.</p>
<p>Hat man einen langfristigen Investitionsansatz, so ist das Risiko einer Investition in den DAX deutlich geringer, als dies oft aus dem Bauch heraus angenommen wird.</p>
<div class="warning dropdown admonition">
<p class="admonition-title">Analyse basiert auf Annahmen!</p>
<p>Wichtig ist an dieser Stelle jedoch zu betonen, dass die Analyse auf vielen Annahmen beruht. Einige davon können wir ändern, um zu schauen, wie sensitiv die Analyse auf diese Annahme reagiert (z.B. könnten wir auch den Tagestiefstpreis nehmen). Andere müssen wir aus Mangel an Alternativen so treffen, können jedoch  kritisch sein (z.B. basiert unsere Analyse auf Yahoo-Daten, die ggf. Fehler beinhaltet). Andere Annahmen sind grundsätzlicher Natur: wir basieren unsere Analyse auf historischen Daten und ziehen daraus Schlüsse für die Zukunft. Dies setzt voraus, dass die Kursentwicklungen in der Zukunft ähnlich sind, wie in der Vergangenheit. Jedoch kann die Zukunft auch ganz andere Entwicklungen beinhaltet, die wir so nicht vorhersehen (z.B. könnte die wirtschaftliche und politische Stellung Deutschlands sich in der Zukunft negativ entwickeln)</p>
</div>
<p>Wir haben feststellen können, dass es für die Analyse nicht viel Programmieraufwand bedarf.</p>
<p>Hier ist die Zusammenfassung unserer Analyse:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_t</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="p">(</span><span class="n">get_stock_data</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="s2">&quot;^GDAXI&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;30-12-1987&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;31-07-2022&quot;</span><span class="p">)</span> <span class="c1"># Herunterladen der Daten</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_returns</span><span class="p">)</span> <span class="c1"># Berechnung der Renditen</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_cumreturns_hist</span><span class="p">,</span> <span class="n">min_t</span><span class="p">)</span> <span class="c1"># Berechnung der kumulierten Renditen je Anlagestartpunkt</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_loss_probabilities</span><span class="p">)</span> <span class="c1"># Berechnung der Verlustwahrscheinlichkeit</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_verlustwahrscheinlichkeit</span><span class="p">)</span> <span class="c1"># Visualisierung der Analyse</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Umsetzung_Fallstudie_48_0.png" src="../../_images/Umsetzung_Fallstudie_48_0.png" />
</div>
</div>
<p>Im weiteren Verlaufe werden wir uns anschauen, wie wir den Programmcode noch verbessern und lesbarer machen können.</p>
</div>
</div>
<div class="section" id="schritt-4-historischer-zufall">
<h2>Schritt 4: Historischer Zufall<a class="headerlink" href="#schritt-4-historischer-zufall" title="Permalink to this headline">¶</a></h2>
<p>Im vorherigen Kapitel haben wir uns zwei Varianten überlegt, wie wir die Ausgangsfrage beantworten können. Schauen wir uns nun an, wie wir die Frage mittels einer Zufallsauswahl der historischen Renditen beantworten können. Viele Veränderung benötigen wir hierfür nicht. Schauen wir uns den vorherigen Programmiercode an, so stellen wir fest, dass nur die Funktion <code class="docutils literal notranslate"><span class="pre">calculate_cumreturns_anlagen</span></code> verändert werden muss bzw. wir hierfür eine andere Funktion schreiben.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">min_t</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="p">(</span><span class="n">get_stock_data</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="s2">&quot;^GDAXI&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;30-12-1987&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;31-07-2022&quot;</span><span class="p">)</span> <span class="c1"># Bleibt unverändert</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_returns</span><span class="p">)</span> <span class="c1"># Bleibt unverändert</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_cumreturns_hist</span><span class="p">,</span> <span class="n">min_t</span><span class="p">)</span> <span class="c1"># Muss ersetzt werden durch neue Funktion</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_loss_probabilities</span><span class="p">)</span> <span class="c1"># Bleibt unverändert</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_verlustwahrscheinlichkeit</span><span class="p">)</span> <span class="c1"># Bleibt unverändert</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_cumrets_random</span><span class="p">(</span><span class="n">_df</span><span class="p">,</span> <span class="n">n_anlagen</span><span class="p">,</span> <span class="n">n_time</span><span class="p">):</span>
    <span class="c1"># Ziehe zufällig (n_time x n_anlagen) Renditen aus Spalte &quot;Rendite&quot;</span>
    <span class="n">rnd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">_df</span><span class="p">[</span><span class="s2">&quot;Rendite&quot;</span><span class="p">],</span> <span class="p">(</span><span class="n">n_time</span><span class="p">,</span> <span class="n">n_anlagen</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Speicher Daten in Dataframe</span>
    <span class="n">anlagen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rnd_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Anlage_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_anlagen</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    
    <span class="c1">## Berechne kumulierte Rendite</span>
    <span class="n">anlagen</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">anlagen</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1">## Verbinde ursprüngliche Daten mit neuen Anlagen-Daten</span>
    <span class="n">data_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">_df</span><span class="p">,</span> <span class="n">anlagen</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
    
    <span class="c1">## Gib Daten aus</span>
    <span class="k">return</span> <span class="n">data_combined</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">get_stock_data</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="s2">&quot;^GDAXI&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;30-12-1987&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;31-07-2022&quot;</span><span class="p">)</span> <span class="c1"># Bleibt unverändert</span>
 <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_returns</span><span class="p">)</span> <span class="c1"># Unverändert</span>
 <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_cumrets_random</span><span class="p">,</span> <span class="n">n_anlagen</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">n_time</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span> <span class="c1"># Berechne kumulierte Renditen auf Basis von Zufallsauswahl </span>
 <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">calculate_loss_probabilities</span><span class="p">)</span> <span class="c1"># Unverändert</span>
 <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_verlustwahrscheinlichkeit</span><span class="p">)</span> <span class="c1"># Unverändert</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Umsetzung_Fallstudie_52_0.png" src="../../_images/Umsetzung_Fallstudie_52_0.png" />
</div>
</div>
</div>
<div class="section" id="gesamtfazit">
<h2>Gesamtfazit<a class="headerlink" href="#gesamtfazit" title="Permalink to this headline">¶</a></h2>
<p>Wie bereits erläutert sollte Ihnen diese Fallstudie einen Eindruck davon vermitteln, was Business Analytics umfasst. Wir haben gesehen, dass ein großer Teil dessen, was wir gemacht haben unabhängig war von operativer Datenanalyse. Zunächst mussten wir die konkrete Frage formulieren und uns detaillierte Gedanken dazu machen, wie wir diese Frage beantworten könnten. Erst im zweiten Schritt haben wir uns dann an die eigentliche Datenanalyse gemacht. Dies zeigt, dass die Nutzung von Tools oder einer Programmiersprache nur Mittel zum Zweck ist. Wir nutzen ein Werkzeug, um ein analytisches Problem zu lösen.</p>
<p>In unserem Falle haben wir <strong>Python</strong> genutzt. Auch wenn vieles von dem, was hier dargestellt wurde neu und noch nicht zu 100% nachvollziehbar ist, sollte diese Fallstudie dennoch einen Eindruck davon vermitteln, wie Datenanalyse in der Praxis aussieht und welche Schritte dafür nötig sind.</p>
<p>Widmen wir uns nun Python und schauen uns in den nächsten Kapiteln an, wie Python konkret funktioniert.</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Der Begriff abspeichern ist an dieser Stelle nicht ganz korrekt bzw. präzise. Eigentlich weisen wir den Output einer Variable zu. Der Computer allokiert dann Speicher für diese Information. In Python beinhaltet die Variable dann die Referenz auf diese Speicheradresse. Für unsere Zwecke sind diese Details jedoch nicht wichtig. In diesem Skript und Kurs werden wir  bewusst unpräzise formulieren, um die Verständlichkeit beim Lesen zu erhöhen.</p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>An dieser Stelle entfernen wir fehlende Datenpunkte ohne weitere Analyse, weshalb die Datenpunkte überhaupt fehlen. Für viele Analysen sollte man dem Grund für die fehlenden Daten jedoch hinterhergehen, um sicherzustellen, dass (i) die Datenquelle ggf. nicht verlässlich ist und/oder (ii) die Ergebnisse nicht verfälschen werden.</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Sie können sich an dieser Stelle bereits merken, dass repetitive Vorgänge im Programmiercode im Grunde nicht vorkommen sollten, da diese nahezu immer automatisiert werden können. Dies werden wir in den nächsten Kapiteln noch lernen.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/chapter_01"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="Introduction_Fallstudie.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Fragestellung</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../chapter_02/Installation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Installation &amp; Setup</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      Durch F. Zeidler<br/>
    
        &copy; Urheberrechte © 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>